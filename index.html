<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pacific Islands Digital Pulse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- SheetJS -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="bg-blue-700 text-white py-6 text-center shadow">
    <h1 class="text-3xl font-bold">ğŸŒ Pacific Islands Digital Pulse</h1>
    <p class="text-lg mt-2">Tracking Internet Usage Across the Blue Pacific</p>
  </header>

  <!-- Content Container -->
  <main class="max-w-6xl mx-auto px-4 py-10">
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10">
      <div class="bg-blue-100 rounded-lg shadow p-6 text-center">
        <h3 class="text-sm text-gray-600 mb-2">Avg. Internet Usage</h3>
        <p id="avgInternet" class="text-3xl font-bold text-blue-700">--%</p>
      </div>
      <div class="bg-blue-100 rounded-lg shadow p-6 text-center">
        <h3 class="text-sm text-gray-600 mb-2">Card 2</h3>
        <p class="text-3xl font-bold text-blue-700">--</p>
      </div>
      <div class="bg-blue-100 rounded-lg shadow p-6 text-center">
        <h3 class="text-sm text-gray-600 mb-2">Card 3</h3>
        <p class="text-3xl font-bold text-blue-700">--</p>
      </div>
    </div>

    <!-- Chart Section -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold text-blue-700 mb-4">ğŸ“Š Internet Usage by Country</h2>
      <canvas id="chart" width="800" height="400"></canvas>
    </div>

  </main>

  <!-- JavaScript to Load Excel and Display Chart -->
  <script>
    feather.replace();

    // Change this to the RAW GitHub URL of your Excel file
    const excelFileUrl = 'https://raw.githubusercontent.com/rovawaqa/pacific-digital-readines/main/Final%20Data.xlsx';

    fetch(excelFileUrl)
      .then(response => response.arrayBuffer())
      .then(data => {
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(sheet);

        // Calculate average internet usage
        const usageValues = jsonData
          .map(row => +row["Proportion of individuals using the Internet"])
          .filter(val => !isNaN(val));
        const avgUsage = usageValues.length
          ? (usageValues.reduce((sum, val) => sum + val, 0) / usageValues.length)
          : 0;
        document.getElementById('avgInternet').textContent = avgUsage.toFixed(1) + "%";

        // Prepare data for chart
        const labels = jsonData.map(row => row["Country"]);
        const values = jsonData.map(row => +row["Proportion of individuals using the Internet"] || 0);

        const ctx = document.getElementById('chart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Internet Usage (%)',
              data: values,
              backgroundColor: 'rgba(54, 162, 235, 0.6)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: {
                display: true,
                text: 'Proportion of Individuals Using the Internet by Country'
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: '% Usage'
                }
              },
              x: {
                title: {
                  display: true,
                  text: 'Country'
                }
              }
            }
          }
        });
      })
      .catch(error => {
        console.error("Error loading Excel file:", error);
        alert("Failed to load Excel data.");
      });
  </script>
</body>
</html>
